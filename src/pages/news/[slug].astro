---
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { getCollection } from "astro:content";
import { SITE } from "../../config/site.mjs";

export async function getStaticPaths() {
  const posts = (await getCollection("news")).filter((post) => !post.data.draft);
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const formattedDate = post.data.date.toLocaleDateString("en-GB", {
  year: "numeric",
  month: "long",
  day: "2-digit",
});
---

<Layout
  title={`${post.data.title} | ${SITE.title}`}
  description={post.data.summary}
  canonicalURL={`${SITE.url}/news/${post.slug}`}
>
  <Header />
  <main id="main-content" role="main" class="py-16 px-4">
    <article class="max-w-3xl mx-auto">
      <div class="mb-8">
        <p class="text-sm uppercase tracking-[0.3em] text-indigo-500">News</p>
        <h1 class="text-3xl md:text-4xl font-semibold text-slate-900 mt-3">
          {post.data.title}
        </h1>
        <p class="text-slate-500 mt-3">{formattedDate}</p>
      </div>

      {post.data.image && (
        <div class="mb-10">
          <img
            src={post.data.image}
            alt={post.data.imageAlt ?? "News image"}
            class="w-full h-72 object-cover rounded-2xl"
            loading="lazy"
          />
        </div>
      )}

      <div class="prose prose-slate max-w-none">
        <Content />
      </div>

      <div class="mt-12">
        <a href="/news" class="text-indigo-600 font-medium hover:text-indigo-700">
          Back to news
        </a>
      </div>
    </article>
  </main>
  <Footer />
</Layout>
