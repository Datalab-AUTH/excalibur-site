---
---

<form
  id="contact-form"
  name="contact"
  method="POST"
  data-netlify="true"
  class="space-y-6"
  aria-label="Contact form"
  novalidate
>
  <!-- Netlify Forms hidden input -->
  <input type="hidden" name="form-name" value="contact" />
  <!-- Honeypot spam protection -->
  <input type="checkbox" name="botcheck" class="hidden" style="display: none;" tabindex="-1" autocomplete="off" />
  <!-- Success Message -->
  <div
    id="success-message"
    class="hidden p-4 bg-green-50 border border-green-200 rounded-lg text-green-800"
    role="alert"
    aria-live="polite"
  >
    <p class="font-medium">Thank you for your message!</p>
    <p class="text-sm mt-1">We'll get back to you soon.</p>
  </div>

  <!-- Error Message -->
  <div
    id="error-message"
    class="hidden p-4 bg-red-50 border border-red-200 rounded-lg text-red-800"
    role="alert"
    aria-live="assertive"
  >
    <p class="font-medium" id="error-text"></p>
  </div>

  <!-- Name Field -->
  <div>
    <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
      Name <span class="text-red-600" aria-label="required">*</span>
    </label>
    <input
      type="text"
      id="name"
      name="name"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-black outline-none transition-colors"
      required
      aria-required="true"
      aria-describedby="name-error"
      autocomplete="name"
    />
    <span
      id="name-error"
      class="mt-1 text-sm text-red-600 hidden"
      role="alert"
      aria-live="polite"
    ></span>
  </div>

  <!-- Email Field -->
  <div>
    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
      Email <span class="text-red-600" aria-label="required">*</span>
    </label>
    <input
      type="email"
      id="email"
      name="email"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-black outline-none transition-colors"
      required
      aria-required="true"
      aria-describedby="email-error"
      autocomplete="email"
    />
    <span
      id="email-error"
      class="mt-1 text-sm text-red-600 hidden"
      role="alert"
      aria-live="polite"
    ></span>
  </div>

  <!-- Message Field -->
  <div>
    <label for="message" class="block text-sm font-medium text-gray-700 mb-2">
      Message <span class="text-red-600" aria-label="required">*</span>
    </label>
    <textarea
      id="message"
      name="message"
      rows="6"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-black outline-none transition-colors resize-none"
      required
      aria-required="true"
      aria-describedby="message-error"
    ></textarea>
    <span
      id="message-error"
      class="mt-1 text-sm text-red-600 hidden"
      role="alert"
      aria-live="polite"
    ></span>
  </div>

  <!-- Submit Button -->
  <button
    type="submit"
    id="submit-button"
    class="btn-pill w-full px-6 py-3 font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black disabled:opacity-50 disabled:cursor-not-allowed"
  >
    <span id="submit-text">Send Message</span>
    <span id="submit-loading" class="hidden">Sending...</span>
  </button>
</form>

<script>
  const form = document.getElementById("contact-form") as HTMLFormElement;
  const submitButton = document.getElementById("submit-button") as HTMLButtonElement;
  const submitText = document.getElementById("submit-text") as HTMLSpanElement;
  const submitLoading = document.getElementById("submit-loading") as HTMLSpanElement;
  const successMessage = document.getElementById("success-message") as HTMLDivElement;
  const errorMessage = document.getElementById("error-message") as HTMLDivElement;
  const errorText = document.getElementById("error-text") as HTMLParagraphElement;

  // Field elements
  const nameInput = document.getElementById("name") as HTMLInputElement;
  const emailInput = document.getElementById("email") as HTMLInputElement;
  const messageInput = document.getElementById("message") as HTMLTextAreaElement;
  const nameError = document.getElementById("name-error") as HTMLSpanElement;
  const emailError = document.getElementById("email-error") as HTMLSpanElement;
  const messageError = document.getElementById("message-error") as HTMLSpanElement;

  // Validation functions
  function validateEmail(email: string): boolean {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  function showFieldError(field: HTMLInputElement | HTMLTextAreaElement, errorElement: HTMLSpanElement, message: string) {
    field.setAttribute("aria-invalid", "true");
    field.classList.add("border-red-500");
    errorElement.textContent = message;
    errorElement.classList.remove("hidden");
  }

  function clearFieldError(field: HTMLInputElement | HTMLTextAreaElement, errorElement: HTMLSpanElement) {
    field.setAttribute("aria-invalid", "false");
    field.classList.remove("border-red-500");
    errorElement.classList.add("hidden");
    errorElement.textContent = "";
  }

  function hideAllMessages() {
    successMessage.classList.add("hidden");
    errorMessage.classList.add("hidden");
  }

  function setLoading(loading: boolean) {
    submitButton.disabled = loading;
    if (loading) {
      submitText.classList.add("hidden");
      submitLoading.classList.remove("hidden");
    } else {
      submitText.classList.remove("hidden");
      submitLoading.classList.add("hidden");
    }
  }

  // Real-time validation
  nameInput.addEventListener("blur", () => {
    const value = nameInput.value.trim();
    if (!value) {
      showFieldError(nameInput, nameError, "Name is required");
    } else if (value.length < 2) {
      showFieldError(nameInput, nameError, "Name must be at least 2 characters");
    } else {
      clearFieldError(nameInput, nameError);
    }
  });

  emailInput.addEventListener("blur", () => {
    const value = emailInput.value.trim();
    if (!value) {
      showFieldError(emailInput, emailError, "Email is required");
    } else if (!validateEmail(value)) {
      showFieldError(emailInput, emailError, "Please enter a valid email address");
    } else {
      clearFieldError(emailInput, emailError);
    }
  });

  messageInput.addEventListener("blur", () => {
    const value = messageInput.value.trim();
    if (!value) {
      showFieldError(messageInput, messageError, "Message is required");
    } else if (value.length < 10) {
      showFieldError(messageInput, messageError, "Message must be at least 10 characters");
    } else {
      clearFieldError(messageInput, messageError);
    }
  });

  // Form submission
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    hideAllMessages();

    // Clear previous errors
    clearFieldError(nameInput, nameError);
    clearFieldError(emailInput, emailError);
    clearFieldError(messageInput, messageError);

    // Validate all fields
    let isValid = true;

    if (!nameInput.value.trim()) {
      showFieldError(nameInput, nameError, "Name is required");
      isValid = false;
    }

    if (!emailInput.value.trim()) {
      showFieldError(emailInput, emailError, "Email is required");
      isValid = false;
    } else if (!validateEmail(emailInput.value.trim())) {
      showFieldError(emailInput, emailError, "Please enter a valid email address");
      isValid = false;
    }

    if (!messageInput.value.trim()) {
      showFieldError(messageInput, messageError, "Message is required");
      isValid = false;
    } else if (messageInput.value.trim().length < 10) {
      showFieldError(messageInput, messageError, "Message must be at least 10 characters");
      isValid = false;
    }

    if (!isValid) {
      // Focus first error field
      const firstError = form.querySelector('[aria-invalid="true"]') as HTMLElement;
      if (firstError) {
        firstError.focus();
      }
      return;
    }

    // Submit form to Netlify
    setLoading(true);

    try {
      const formData = new FormData(form);

      const response = await fetch("/", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams(formData).toString(),
      });

      if (response.ok) {
        successMessage.classList.remove("hidden");
        form.reset();
        // Scroll to success message
        successMessage.scrollIntoView({ behavior: "smooth", block: "nearest" });
      } else {
        errorText.textContent = "Failed to send message. Please try again.";
        errorMessage.classList.remove("hidden");
        errorMessage.scrollIntoView({ behavior: "smooth", block: "nearest" });
      }
    } catch (error) {
      errorText.textContent = "Network error. Please check your connection and try again.";
      errorMessage.classList.remove("hidden");
      errorMessage.scrollIntoView({ behavior: "smooth", block: "nearest" });
    } finally {
      setLoading(false);
    }
  });
</script>
